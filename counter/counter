#!/bin/bash

# COUNTER_FILE="$HOME/tcred/counter/storage.txt"

# count=$(cat $COUNTER_FILE)
# count=$((count + 1))
# echo $count > $COUNTER_FILE

COUNTER_FILE="$HOME/tcred/counter/storage.json"

# Перевіряємо, чи існує файл, якщо ні - створюємо його з порожнім об'єктом
if [ ! -f "$COUNTER_FILE" ]; then
    echo "{}" > "$COUNTER_FILE"
fi

# Отримуємо поточну дату
current_date=$(date +"%Y-%m-%d")

# Зчитуємо поточний вміст файлу
data=$(cat "$COUNTER_FILE")

# Отримуємо поточне значення лічильника для поточної дати
count=$(echo "$data" | jq -r --arg date "$current_date" '.[$date] // 0')

# Збільшуємо лічильник на 1
count=$((count + 1))

# Оновлюємо JSON з новим значенням лічильника
updated_data=$(echo "$data" | jq --arg date "$current_date" --argjson count "$count" '.[$date] = $count')

# Записуємо оновлений JSON у файл
echo "$updated_data" > "$COUNTER_FILE"

# Виводимо поточне значення лічильника
echo "Скрипт був запущений $count разів на дату $current_date"