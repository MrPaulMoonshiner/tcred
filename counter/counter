#!/bin/bash

# COUNTER_FILE="$HOME/tcred/counter/storage.txt"

# count=$(cat $COUNTER_FILE)
# count=$((count + 1))
# echo $count > $COUNTER_FILE

COUNTER_FILE="$HOME/tcred/counter/storage"

# Перевіряємо, чи існує файл, якщо ні - створюємо його
if [ ! -f "$COUNTER_FILE" ]; then
    echo "{}" > "$COUNTER_FILE"
fi

# Ініціалізуємо асоціативний масив
declare -A counter

# Зчитуємо поточний вміст файлу у масив
while IFS="=" read -r key value; do
    counter["$key"]="$value"
done < "$COUNTER_FILE"

# Отримуємо поточну дату
current_date=$(date +"%Y-%m-%d")

# Перевіряємо існування елемента масиву по ключу (поточна дата)
if [ -z "${counter[$current_date]}" ]; then
    counter["$current_date"]=1
else
    counter["$current_date"]=$((counter["$current_date"] + 1))
fi

# Записуємо оновлений масив у файл
> "$COUNTER_FILE"
for key in "${!counter[@]}"; do
    echo "$key=${counter[$key]}" >> "$COUNTER_FILE"
done